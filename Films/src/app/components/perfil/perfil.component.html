<section class="profile">
  <section class="box-mi-perfil">
    <img class="account" src="/assets/account.png" alt="">
    <h2 class="sub-title">Mi perfil</h2>
  </section>

  <section class="box-datos-personales">
    <h3 class="sub-title">Datos personales</h3>
    <div class="container">
      <h4>Nombre</h4>
      <div class="contenido-infomacion-personal">
        <div class="box-1">
          <p *ngIf="!isEditingFirstName" class="paragraph">{{ usuarioActual?.firstName }}</p>
          <form action="#" [formGroup]="formGroupFirstName">
            <input class="edit-input" *ngIf="isEditingFirstName" formControlName="firstname"/>
          </form>
  
          <button class="edit" *ngIf="!isEditingFirstName" (click)="toggleEditFirstame()">
            <img class="img-edit" src="/assets/Edit.png" alt="">
          </button>
  
          <div class="options-container">
             <button class="confirm-button" *ngIf="isEditingFirstName" (click)="confirmChangeFirstName()">✔</button>
             <button class="cancel-button" *ngIf="isEditingFirstName" (click)="cancelEdit()">✖</button>
          </div>
        </div>

        <div *ngIf="!showErrors && firstname_fc?.invalid && (firstname_fc?.dirty || firstname_fc?.touched)" class="errors">
          <div *ngIf="firstname_fc?.hasError('required')" class="text-danger">El nombre es requerido</div>
          <div *ngIf="firstname_fc?.hasError('soloLetras')" class="text-danger">Solo letras</div>
        </div>

        <div id="resultado-operacion" class="mt-3">{{resultFirstName}}</div>
      </div>

      <h4>Apellido</h4>
      <div class="contenido-infomacion-personal">
        <div class="box-1">
          <p *ngIf="!isEditingLastName" class="paragraph">{{usuarioActual?.lastName}}</p>
          <form action="#" [formGroup]="formGroupLastName">
            <input class="edit-input" *ngIf="isEditingLastName" formControlName="lastname"/>
          </form>
  
          <button class="edit" *ngIf="!isEditingLastName" (click)="toggleEditLastName()">
            <img class="img-edit" src="/assets/Edit.png" alt="">
          </button>

          <div class="options-container">
             <button class="confirm-button" *ngIf="isEditingLastName" (click)="confirmChangeLastName()">✔</button>
             <button class="cancel-button" *ngIf="isEditingLastName" (click)="cancelEdit()">✖</button>
          </div>
        </div>

        <div *ngIf="!showErrors && lastname_fc?.invalid && (lastname_fc?.dirty || lastname_fc?.touched)" class="errors">
          <div *ngIf="lastname_fc?.hasError('required')" class="text-danger">El apellido es requerido</div>
          <div *ngIf="firstname_fc?.hasError('soloLetras')" class="text-danger">Solo letras</div>
        </div>

        <div id="resultado-operacion" class="mt-3">{{resultLastName}}</div>
      </div>

      <h4>DNI</h4>
      <div class="contenido-dni">
        <div class="box-1">
          <p *ngIf="!isEditingDni" class="paragraph">{{ usuarioActual?.dni }}</p>
          <form action="#" [formGroup]="formGroupDNI">
            <input class="edit-input" *ngIf="isEditingDni" formControlName="dni"/>
          </form>
  
          <button class="edit" *ngIf="!isEditingDni" (click)="toggleEditDni()">
            <img class="img-edit" src="/assets/Edit.png" alt="">
          </button>
  
          <div class="options-container">
            <button class="confirm-button" *ngIf="isEditingDni" (click)="confirmChangeDNI()">✔</button>
            <button class="cancel-button" *ngIf="isEditingDni" (click)="cancelEdit()">✖</button>
          </div>
        </div>

        <div *ngIf="!showErrors && dni_fc?.invalid && (dni_fc?.dirty || dni_fc?.touched)" class="errors">
          <div *ngIf="dni_fc?.hasError('required')" class="text-danger">El DNI es requerido</div>
          <div *ngIf="dni_fc?.hasError('soloNumeros')" class="text-danger">DNI contiene solo numeros</div>
        </div>

        <div id="resultado-operacion" class="mt-3">{{resultDNI}}</div>
      </div>
    </div> 
  </section>

  <section class="box-datos-de-cuenta">
    <h3 class="sub-title">Datos de Cuenta</h3>
    <div class="container">
      <h4>E-mail</h4>
      <div class="contenido-datos-de-cuenta">
        <div class="box-1">
          <div class="box-email-edit">
            <p *ngIf="!isEditingEmail" class="paragraph">{{usuarioActual?.email}}</p>
            <form action="#" [formGroup]="formGroupEmail">
              <input type="email" class="edit-input" *ngIf="isEditingEmail" formControlName="email"/>
            </form>
    
            <button class="edit" *ngIf="!isEditingEmail" (click)="toggleEditEmail()">
              <img class="img-edit" src="/assets/Edit.png" alt="">
            </button>
          </div>
  
          <div class="options-container">
            <button class="confirm-button" *ngIf="isEditingEmail" type="submit" (click)="confirmChangeEmail()">✔</button>
            <button class="cancel-button" *ngIf="isEditingEmail" (click)="cancelEdit()">✖</button>
          </div>
        </div>

        <div *ngIf="!showErrors && email_fc?.invalid && (email_fc?.dirty || email_fc?.touched)" class="errors">
          <div *ngIf="email_fc?.hasError('required')" class="text-danger">El email es requerido</div>
          <div *ngIf="email_fc?.hasError('email')" class="text-danger">Formato de Email Incorrecto</div>
        </div>

        <div id="resultado-operacion" class="mt-3">{{resultEmail}}</div>
      </div>
    </div>
  </section>

  <section class="box-domicilios">
    <h3 class="sub-title">Domicilios</h3>
    <div class="container">
      <h4>Direccion</h4>
      <div class="contenido-datos-domicilios">
        <div class="box-1">
          <p *ngIf="!isEditingAddress" class="paragraph"> {{usuarioActual?.address}}</p>
          <form action="#" [formGroup]="formGroupAddress">
            <input class="edit-input" *ngIf="isEditingAddress" formControlName="address" />
          </form>
  
          <button class="edit" *ngIf="!isEditingAddress" (click)="toggleEditAddress()">
            <img class="img-edit" src="/assets/Edit.png" alt="">
          </button>
  
          <div class="options-container">
            <button class="confirm-button" *ngIf="isEditingAddress" (click)="confirmChangeAddress()">✔</button>
            <button class="cancel-button" *ngIf="isEditingAddress" (click)="cancelEdit()">✖</button>
          </div>
        </div>

        <div *ngIf="!showErrors && address_fc?.invalid && (address_fc?.dirty || address_fc?.touched)" class="errors">
          <div *ngIf="address_fc?.hasError('required')" class="text-danger">La direccion es requerida</div>
        </div>

        <div id="resultado-operacion" class="mt-3">{{resultAddress}}</div>
      </div>
    </div>
  </section>

  <section class="box-tarjetas">
    <h3 class="sub-title">Mis Tarjetas</h3>
    <div class="container">
      <div class="box-1">

        <div class="mis-tarjetas">
          
          <div class="tarjeta" *ngIf="cardExists">
            <div class="chip"></div>
            <div class="box-datos">
              <p class="dato-tarjeta nTarjeta" *ngIf="!permitirEditarTarjeta"> **** **** **** {{lastFourDigits}}</p>
              <form class="formEditCard dato-tarjeta nTarjeta" action="#" [formGroup]="cardFormGroup" *ngIf="permitirEditarTarjeta">
                <input id="numberCard" class="dato-tarjeta nTarjeta input-edit" type="text" formControlName="nTarjeta">
              </form>
            </div>
            <div class="box-datos">
              <p class="dato-tarjeta vencimiento"  *ngIf="!permitirEditarTarjeta">{{ usuarioActual?.tarjeta?.fechaVencimiento }}</p>
              <form class="formEditCard dato-tarjeta vencimiento" action="#" [formGroup]="cardFormGroup" *ngIf="permitirEditarTarjeta">
                <input class="dato-tarjeta vencimiento input-edit" type="text" formControlName="fechaVencimiento">
              </form>
            </div>
            <div class="last-data">
              <div class="box-fullname">
                <div class="box-datos">
                  <p class="dato-tarjeta fullname"  *ngIf="!permitirEditarTarjeta">{{usuarioActual?.tarjeta?.firstName}}</p>
                  <form class="formEditCard dato-tarjeta" action="#" [formGroup]="cardFormGroup" *ngIf="permitirEditarTarjeta">
                    <input id="firstname" class="dato-tarjeta fullname-input input-edit" type="text" formControlName="firstName">
                  </form>
                </div>
                <div class="box-datos">
                  <p class="dato-tarjeta fullname"  *ngIf="!permitirEditarTarjeta">{{usuarioActual?.tarjeta?.lastName}}</p>
                  <form class="formEditCard dato-tarjeta" action="#" [formGroup]="cardFormGroup" *ngIf="permitirEditarTarjeta">
                    <input id="lastname" class="dato-tarjeta fullname-input input-edit" type="text" formControlName="lastName">
                  </form>
                </div>
              </div>
              <p class="dato-tarjeta tipo-tarjeta">VISA</p>
            </div>
          </div>

          <div class="non-existent-card" *ngIf="!cardExists">
            <p class="paragraph">Aun no tiene una tarjeta cargada...</p>
          </div>

          <div class="box-opciones-tarjeta">
              <button *ngIf="!cardExists" class="button-new-tarjeta" (click)="showFormAddCard()"> 
                Agregar Tarjeta
              </button>
              <div *ngIf="formAddCard" class="tarjeta-form-overlay">
                <button class="cancel-form" (click)="hideFormAddCard()">X</button>
                <app-tarjeta-form></app-tarjeta-form>
              </div>
              <div *ngIf="cardExists" class="card-exist">
                
                <button *ngIf="showOptionButtonsToCard" class="button-delete" (click)="deleteCard()">
                  <img class="delete" src="/assets/delete.png" alt="">
                </button>
                <button *ngIf="showOptionButtonsToCard" class="edit button-edit-tarjeta" (click)="toggleFormPassword()">
                  <img class="img-edit-tarjeta" src="/assets/Edit.png" alt="">
                </button>

                <div *ngIf="showFormularioPassword">
                  <div class="form-password">
                    <div class="box-field">
                        <h5 class="field">Ingrese su contraseña para seguir</h5>
                        <div class="box-input-password">
                          <input id="input-password" [(ngModel)]="passwordToEdit" type="text" placeholder="Contraseña...">
                        </div>
                    </div>
                    <div class="box-options-password">
                      <button class="button" (click)="toggleFormPassword()">Cancelar</button>
                      <button class="button" (click)="verifyPassword()">Enviar</button>
                    </div>
                    <div class="box-error">
                      {{resultInputPassword}}
                    </div>
                  </div>
                </div>

                <div class="box-options-edit-card" *ngIf="activeOptionsEditCard">
                  <button id="button-cancel-edit-card" class="button-option-edit-card" (click)="cancelEditCard()">✖</button>
                  <button class="button-option-edit-card" (click)="confirmEditCard()">✔</button>
                </div>

                <div>{{resultEditCard}}</div>

              </div>
          </div>
          <p *ngIf="!usuarioActual?.tarjeta">No tienes una tarjeta asociada</p>
        </div>
      
      </div>
    </div>

  </section>

  <section class="box-logout">
    <div class="contenido-logout">
      <button class="button-logout" (click)="openLogoutModal()">Cerrar sesión</button>
    </div>

    <div *ngIf="isLogoutModalVisible" class="modal-overlay">
      <div class="modal-content">
        <h3>¿Deseas cerrar sesión?</h3>
        <div class="modal-buttons">
          <button class="cancel-button-logout" (click)="closeLogoutModal()">Cancelar</button>
          <button class="confirm-button-logout" (click)="logout()">Confirmar</button>
        </div>
      </div>
    </div>
  </section>
</section>

